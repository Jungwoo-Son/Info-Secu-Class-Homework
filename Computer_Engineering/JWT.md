# JWT

JWT(json web token)
토큰 방식 인증에서 주로 쓰이는 방식

기존의 세션 방식은 서버에게 너무 큰 부담을 주었다.
토큰 방식은 서버에서 클라이언트로 토큰을 발급해주고
클라이언트는 발급받은 토큰을 서버로 보낸다.
서버는 이것이 유효한지 확인한다.

## JWT 구조

JWT는 세가지로 나뉜다.

- 해더
- 페이로드
- 서명



### 헤더

헤더에는 typ과 alg로 나뉘고 typ는 "JWT"가 alg는 해쉬 알고리즘이 들어간다.

```JSON
{
    "typ": "JWT",
    "alg": "HS256"
}
```



### 내용

토큰에 담을 내용들이 담겨있다.
하나의 정보를 클레임이라하고 몇몇 미리 등록된 클레임과 사용자 지정 클레임이 있다.
모든 클레임은 선택적으로 포함할 수 있다.

등록된 클레임

- exp: 토큰의 만료시간
- iat: 토큰 발급 시간
- iss: 토큰 발급자
- aud: 토큰 대상자
- sub: 토큰 제목
- nbf: 토큰 활성 시기(이 시기가 지나기 전까지 토큰은 처리되지 않는다.)
- jti: JWT 고유 식별자로 중복처리 방지에 쓰임(일회용 토큰 등)

사용자 지정클레임

- 공개 클레임: 충돌을 피해야하는 클레임이다. (url등을 이용해서 피하면 된다.)
- 비공개 클레임: 이용하는 서버와 미리 약속된 클레임이면 된다.

### 서명

헤더와 내용을 base64로 인코딩후 지정된 비밀키을 이용해 헤더에서 지정된 알고리즘으로 해싱한다.

대략적으로 이런 알고리즘을 가진다 

hash(base64(header) + "." + 
          base64(content),
          secretKey);



### 결과

형태: aaaa.bbbb.cccc

첫번쩨 필드에 헤더가 base64로 인코딩 된 것이 들어간다.

두번째 필드에 내용이 base64로 인코딩 된 것이 들어간다.

세번째 필드에 서명이 들어간다.





## JWT 단점

인증 토큰이 세션처럼 서버에서 관리되는 것이 아니기 때문에
한 계정으로 여러 기기에서 로그인 하는 것을 막거나 의심스러운 특정 토큰을 만료시킬 수 없다.

