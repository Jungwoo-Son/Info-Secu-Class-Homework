# 인터럽트

인터럽트란 CPU가 프로그램을 실행하고 있을 때, 입출력 장치 혹은 예외상황이 발생하여 처리가 필요할 경우 CPU에게 알려서 즉시 처리할 수 있돌고 하는 것을 말한다.

### 인터럽트 종류

인터럽트의 종류로는 크게 외부 인터럽트와 내부 인터럽트 그리고 소프트웨어 인터럽트, 세가지로 나눌 수 있다.

- 외부 인터럽트

  전원 이상 인터럽트 : 정전, 파워 이상 등으로 발생한다.

  기계 착오 인터럽트 : CPU의 기능적인 오류로 발생한다.

  외부 신호 인터럽트 : 타이머나 키보드 인터럽트(콘솔에서 Ctrl + c 등) 혹은 외부 장치로 부터의 인터럽트 중 I/O 인터럽트가 아닌 것.

  입출력 인터럽트 : 입출력 장치가 데이터 전송을 요구 혹은 전송이 완료됐을 때 혹은 입출력 데이터에 이상이 있을 때 발생한다.

- 내부 인터럽트
  잘못된 명령이나 잘못된 데이터를 사용할 때 발생한다

  프로그램 체크에서 발생한다.
  예로 0으로 나누기, 오버플로우, 언더플로우, exception 발생, 잘못된 메모리 접근 등이 있다.

- 소프트웨어 인터럽트
  대표적으로 SVC(supervisor call)이 있으며 커널로 작업 권한을 넘길 때 발생한다. system call이 이에 해당한다.

이러한 인터럽트들은 동시에 발생하거나 이미 인터럽트 처리 중일 때 다시 인터럽트가 발생한 경우 우선순위를 따지게 된다.

1. 전원 이상
2. 기계 착오
3. 외부 신호
4. 입출력
5. 잘 못된 명령
6. SVC



### 인터럽트 처리 절차

1. 현재 진행 중인 기계어 코드를 완료한다.
2. 특수 레지스터 내의 인터럽트 마스크 비트를 확인하여 처리를 결정하고 우선순위를 결정한다.
3. 인터럽트 벡터 테이블를 읽어 ISR 주소값을 얻는다.
4. ISR 주소값으로 점프한다.
5. PC를 비롯한 레지스터를 스택으로 대피시킨다.
6. ISR 코드르 실행한다.
7. 다 처리하면 대피시킨 레지스터를 복원한다.
8. IRET(RETI) 명령어에 의해 인터럽트가 해제된다.
9. PC 값을 복원하고 이전 실행 위치로 복원한다.



### ISR

ISR은 인터럽트 서비스 루틴이며 인터럽트 핸들러라고도 한다.
이는 인터럽트가 발생했을 때 해당 인터럽트로 어떤 작업을 할 것인지를 정한다.

단 C언어의 함수와는 어셈블리 단계에서 차이가 존재한다. 함수는 CALL로 부르고 RET명령으로 복귀하지만 ISR은 CALL 없이 바로 점프로 이루어 지고 여러 레지스터를 스택에 올리고 RETI로 복귀한다. 이런 이유로 인터럽트를 직접 개발할 때 개발 환경에 따라 방식이 달라진다.



### 인터럽트 벡터

ISR의 주소가 모여있는 테이블이다.

